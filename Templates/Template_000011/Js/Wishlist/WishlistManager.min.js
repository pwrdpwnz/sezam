var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),WishlistManager;(function(n){var f=function(){function n(){}return n}(),i,r,t,u;n.WishlistItem=f;i=function(){function n(n){this.Element=n}return n.prototype.Count=function(n){n<1?this.Element.find("#wishlist-items-count").hasClass("hide-counter-for-empty")?this.Element.find("#wishlist-items-count").css("display","none").text("0"):this.Element.find("#wishlist-items-count").css("display","flex").text("0"):this.Element.find("#wishlist-items-count").css("display","flex").text(n.toString())},n}();n.WishlistPlugin=i;r=function(n){function t(){var t=n.call(this)||this;return t.Plugins=[],$("div.plugin-wishlist").each(function(n,r){t.Plugins.push(new i($(r)))}),t}return __extends(t,n),t.prototype.Count=function(n){this.Plugins.forEach(function(t){t.Count(n)})},t}(EcoStateUI.StateEventsUI);n.WishlistPlugins=r;t=function(n){function t(t){var i=n.call(this)||this;i.Element=t;i.AddUrl=$(t).data("add-url");i.RemoveUrl=$(t).data("remove-url");i.Element.off("click").on("click",function(){return i.trigger("click",i),!1});return i}return __extends(t,n),Object.defineProperty(t.prototype,"ItemID",{get:function(){return this.Element.data("id")?parseInt(this.Element.data("id")):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsModification",{get:function(){return this.Element.data("modification")?Boolean(this.Element.data("modification")):!1},enumerable:!1,configurable:!0}),t.prototype.SetProcess=function(n,t){n?(t?this.Element.addClass("adding"):this.Element.addClass("removing"),this.Element.addClass("process"),this.trigger("process")):(this.Element.removeClass("adding"),this.Element.removeClass("removing"),this.Element.removeClass("process"),this.trigger("process"))},t.prototype.IsProcess=function(){return this.Element.hasClass("process")},t.prototype.IsAdded=function(){return this.Element.hasClass("added")},t.prototype.SetAdded=function(n){this.SetProcess(!1,!1);n?(this.Element.addClass("added"),this.trigger("added",this)):(this.Element.removeClass("added"),this.trigger("removed",this))},t}(EcoStateUI.StateEventsUI);n.Action=t;u=function(n){function i(t){var i=n.call(this)||this;return i._items=[],i.Refresh(t),i}return __extends(i,n),i.prototype.Refresh=function(n){var i=this;this.Actions=[];this.Plugins=new r;$(n).each(function(n,t){i.AddAction(t)});$(n).each(function(n,r){$(r).on("changed",function(){i.AddAction(r)});$(r).on("changing",function(){var u=new t($(r)),n=i.Actions.filter(function(n){return n.ItemID===u.ItemID})[0];n&&i.Actions.splice(i.Actions.indexOf(n),1)})});this.RefreshItems()},Object.defineProperty(i.prototype,"Items",{get:function(){return this._items},set:function(n){this._items=n;n?(this.RefreshItems(),this.Plugins.Count(this._items.length)):(this.Actions.forEach(function(n){n.SetAdded(!1)}),this.Plugins.Count(0));this.trigger("apply",{Items:n})},enumerable:!1,configurable:!0}),i.prototype.RefreshItems=function(){var n=this;this._items&&this._items.forEach(function(t){n.Actions.forEach(function(n){n.ItemID==t.ID&&n.IsModification==t.IsModification&&n.SetAdded(!0)})})},i.prototype.AddAction=function(n){var r=this,i=new t($(n));i.on("added",function(n){r.trigger("added",n)});i.on("removed",function(n){r.trigger("removed",n)});i.on("click",function(n,t){if(t.IsProcess()==!1)if(typeof _user=="undefined"||window._user.IsAuth()===!1)$("#account a, .plugin-authentication a").trigger("click");else{var i=t.IsAdded()?t.RemoveUrl:t.AddUrl;i&&i.length>0&&(t.SetProcess(!0,!t.IsAdded()),$.post(i,{id:t.ItemID},function(n){n.type=="success"&&(t.SetAdded(!t.IsAdded()),r.Items=jQuery.parseJSON(n.result.Wishlist))}).fail(function(){$().toastmessage("showToast",{text:"<h2>Fail<\/h2><p>Please try again later.<\/p>",sticky:!1,position:"top-right",type:"success",inEffectDuration:600,stayTime:5e3})}).always(function(){t.SetProcess(!1,!1)}))}});this.Actions.push(i)},i}(EcoStateUI.StateEventsUI);n.WishListAction=u})(WishlistManager||(WishlistManager={}));