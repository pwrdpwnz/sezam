var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),CompareManager;(function(n){var e=function(){function n(){}return n}(),i,r,t,u,f;n.CompareItem=e;i=function(){function n(n){this.Element=n}return n.prototype.Count=function(n){n<1?this.Element.find("#compare-items-count").hasClass("hide-counter-for-empty")?this.Element.find("#compare-items-count").css("display","none").text("0"):this.Element.find("#compare-items-count").css("display","flex").text("0"):this.Element.find("#compare-items-count").css("display","flex").text(n.toString())},n}();n.ComparePlugin=i;r=function(n){function t(){var t=n.call(this)||this;return t.Plugins=[],$("div.plugin-compare").each(function(n,r){t.Plugins.push(new i($(r)))}),t}return __extends(t,n),t.prototype.Count=function(n){this.Plugins.forEach(function(t){t.Count(n)})},t}(EcoStateUI.StateEventsUI);n.ComparePlugins=r;t=function(n){function t(t){var i=n.call(this)||this;i.Element=t;i.AddUrl=$(t).data("add-url");i.RemoveUrl=$(t).data("remove-url");i.Element.off("click").on("click",function(){return i.trigger("click",i),!1});return i}return __extends(t,n),Object.defineProperty(t.prototype,"ItemID",{get:function(){return this.Element.data("id")?parseInt(this.Element.data("id")):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsModification",{get:function(){return this.Element.data("modification")?Boolean(this.Element.data("modification")):!1},enumerable:!1,configurable:!0}),t.prototype.IsProcess=function(){return this.Element.hasClass("process")},t.prototype.IsAdded=function(){return this.Element.hasClass("added")},t}(EcoStateUI.StateEventsUI);n.Action=t;u=function(n){function i(t){var i=n.call(this)||this;return i._items=[],i.Refresh(t),i}return __extends(i,n),i.prototype.Refresh=function(n){var i=this;this.Actions=[];this.Plugins=new r;$(n).each(function(n,t){i.AddAction(t)});$(n).each(function(n,r){$(r).on("changed",function(){i.AddAction(r)});$(r).on("changing",function(){var u=new t($(r)),n=i.Actions.filter(function(n){return n.ItemID===u.ItemID})[0];n&&i.Actions.splice(i.Actions.indexOf(n),1)})});this.RefreshItems()},Object.defineProperty(i.prototype,"Items",{get:function(){return this._items},set:function(n){this._items=n;n?(this.RefreshItems(),this.Plugins.Count(this._items.length)):(this.Actions.forEach(function(n){n.trigger("removed",{Init:!0});n.Element.removeClass("added")}),this.Plugins.Count(0));this.trigger("apply",{Items:n})},enumerable:!1,configurable:!0}),i.prototype.RefreshItems=function(){var n=this;this._items&&this._items.forEach(function(t){n.Actions.forEach(function(n){n.ItemID==t.ID&&n.IsModification==t.IsModification&&(n.trigger("added",{Init:!0}),n.Element.addClass("added"))})})},i.prototype.AddAction=function(n){var r=this,i=new t($(n));i.on("added",function(n,t){r.trigger("added",{Action:n,Init:t.Init})});i.on("removed",function(n,t){r.trigger("removed",{Action:n,Init:t.Init})});i.on("adding",function(n,t){r.trigger("adding",{Action:n,Init:t.Init})});i.on("removing",function(n,t){r.trigger("removing",{Action:n,Init:t.Init})});i.on("error",function(n){r.trigger("error",{Action:n})});i.on("click",function(n,t){if(t.IsProcess()==!1){var i=t.IsAdded()?t.RemoveUrl:t.AddUrl;i&&i.length>0&&(t.trigger("process"),t.Element.addClass("process"),t.IsAdded()?(t.trigger("removing",{Init:!1}),t.Element.addClass("removing")):(t.trigger("adding",{Init:!1}),t.Element.addClass("adding")),$.post(i,{id:t.ItemID},function(n){n.type=="success"&&(t.IsAdded()?(t.trigger("removed",{Init:!1}),t.Element.addClass("removed"),t.Element.removeClass("added")):(t.trigger("added",{Init:!1}),t.Element.addClass("added"),t.Element.removeClass("removed")),r.Items=jQuery.parseJSON(n.result.Compare))}).fail(function(){t.trigger("error")}).always(function(){t.Element.removeClass("process");t.Element.removeClass("adding");t.Element.removeClass("removing")}))}});this.Actions.push(i)},i}(EcoStateUI.StateEventsUI);n.CompareAction=u;f=function(n){function i(t){var i=n.call(this)||this;return i._items=[],i.Refresh(t),i}return __extends(i,n),i.prototype.Refresh=function(n){var t=this;this.Actions=[];$(n).each(function(n,i){t.AddAction(i)});this.RefreshItems()},Object.defineProperty(i.prototype,"Items",{get:function(){return this._items},set:function(n){var t=this;this._items=n;n?this.RefreshItems():this.Actions.forEach(function(n){n.trigger("removed",t);n.Element.removeClass("added")});this.trigger("apply",{Items:n})},enumerable:!1,configurable:!0}),i.prototype.RefreshItems=function(){var n=this;this._items&&this._items.forEach(function(t){n.Actions.forEach(function(i){i.ItemID==t.ID&&i.IsModification==t.IsModification&&(i.trigger("added",n),i.Element.addClass("added"))})})},i.prototype.AddAction=function(n){var i=this,r=new t($(n));r.on("removed",function(n){i.trigger("removed",n)});r.on("removing",function(n){i.trigger("removing",n)});r.on("click",function(n,t){var r=t.RemoveUrl;r&&r.length>0&&(t.trigger("process"),t.Element.addClass("process"),t.IsAdded()?(t.trigger("removing",i),t.Element.addClass("removing")):(t.trigger("adding",i),t.Element.addClass("adding")),$.post(r,{id:t.ItemID},function(n){n.type=="success"&&(t.IsAdded()?(t.trigger("removed",i),t.Element.addClass("removed"),t.Element.removeClass("added")):(t.trigger("added",i),t.Element.addClass("added"),t.Element.removeClass("removed")),i.Items=jQuery.parseJSON(n.result.Compare))}).fail(function(){$().toastmessage("showToast",{text:"<h2>Fail<\/h2><p>Please try again later.<\/p>",sticky:!1,position:"top-right",type:"success",inEffectDuration:600,stayTime:5e3})}).always(function(){t.Element.removeClass("process");t.Element.removeClass("adding");t.Element.removeClass("removing")}))});this.Actions.push(r)},i}(EcoStateUI.StateEventsUI);n.CompareContainerAction=f})(CompareManager||(CompareManager={}));